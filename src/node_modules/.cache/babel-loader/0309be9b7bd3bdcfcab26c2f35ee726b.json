{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport backendURL from \"../../\";\nimport useAccess from \"./accessToken\";\nexport const verifyToken = async () => {\n  _s();\n\n  const old_accesstoken = access;\n  const refreshtoken = await localStorage.getItem(\"refreshToken\");\n  const {\n    access,\n    setAccess\n  } = useAccess(''); // Verifying access token___________________________________________________________________________________\n\n  const verify_access_token = await fetch(`${backendURL}/user/verifyAccess/`, {\n    method: 'POST',\n    headers: {\n      'Accept': 'Application/JSON',\n      'Content-Type': 'Application/json'\n    },\n    body: JSON.stringify({\n      \"token\": old_accesstoken\n    })\n  });\n\n  if (verify_access_token.status === 401) {\n    const get_access_token = await fetch(`${backendURL}/user/refresh/`, {\n      method: 'POST',\n      headers: {\n        'Accept': 'Application/JSON',\n        'Content-Type': 'Application/json'\n      },\n      body: JSON.stringify({\n        \"refresh\": refreshtoken\n      })\n    });\n\n    if (get_access_token.status === 200) {\n      await localStorage.setItem(\"refreshToken\", text.refresh);\n      setAccess({\n        access: text.access\n      });\n    }\n  }\n\n  ; // Verifying refresh token__________________________________________________________________________________\n\n  const verify_refresh_token = await fetch(`${backendURL}/user/verifyRefresh/`, {\n    method: 'POST',\n    headers: {\n      'Accept': 'Application/JSON',\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      \"token\": refreshtoken\n    })\n  });\n\n  if (verify_refresh_token.status === 401) {\n    alert(\"session expired, please log in again\");\n    window.location.assign(\"/login\");\n  } //validating access token___________________________________________________________________________________ \n\n\n  if (accesstoken === null) {\n    console.log(\"No credentials found, redirecting...\");\n    window.location = \"/index/login/\";\n    return [];\n  }\n};\n\n_s(verifyToken, \"m5BZZFaE96oLqqnIYn6H8qCab84=\", false, function () {\n  return [useAccess];\n});","map":{"version":3,"names":["backendURL","useAccess","verifyToken","old_accesstoken","access","refreshtoken","localStorage","getItem","setAccess","verify_access_token","fetch","method","headers","body","JSON","stringify","status","get_access_token","setItem","text","refresh","verify_refresh_token","alert","window","location","assign","accesstoken","console","log"],"sources":["/home/gcg/Desktop/Programing /python/Django main projects/projects/businessManagement/react_BusinessManagement/src/features/auths/verifyTokens.js"],"sourcesContent":["import backendURL from \"../../\"\nimport useAccess from \"./accessToken\"\n\n\nexport const verifyToken = async () => {\n    const old_accesstoken = access\n    const refreshtoken = await localStorage.getItem(\"refreshToken\");\n    const {access, setAccess} = useAccess('')\n    \n    // Verifying access token___________________________________________________________________________________\n    const verify_access_token = await fetch(\n\n      `${backendURL}/user/verifyAccess/`,\n      {\n          method: 'POST',\n          headers: {\n              'Accept': 'Application/JSON',\n              'Content-Type': 'Application/json',\n          },\n          body: JSON.stringify({\n            \"token\": old_accesstoken,\n          })\n      }\n    );\n  \n    if (verify_access_token.status === 401) {\n      const get_access_token = await fetch(\n        `${backendURL}/user/refresh/`,\n        {\n            method: 'POST',\n            headers: {\n                'Accept': 'Application/JSON',\n                'Content-Type': 'Application/json',\n            },\n            body: JSON.stringify({\n              \"refresh\": refreshtoken,\n            })\n        }\n      );\n  \n      if (get_access_token.status === 200) {\n        await localStorage.setItem(\"refreshToken\", text.refresh);\n        setAccess(\n            {\n                access:text.access,\n            }\n        )\n      }\n  \n    };\n    \n    // Verifying refresh token__________________________________________________________________________________\n    const verify_refresh_token = await fetch(\n      `${backendURL}/user/verifyRefresh/`,\n      {\n          method: 'POST',\n          headers: {\n              'Accept': 'Application/JSON',\n              'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            \"token\": refreshtoken,\n          })\n      }\n    );\n  \n    if (verify_refresh_token.status === 401) {\n      alert(\"session expired, please log in again\")\n      window.location.assign(\"/login\");\n    }\n  \n  \n    //validating access token___________________________________________________________________________________ \n    if (accesstoken === null) {\n      console.log(\"No credentials found, redirecting...\");\n      window.location = \"/index/login/\";\n      return [];\n    }\n}"],"mappings":";;AAAA,OAAOA,UAAP,MAAuB,QAAvB;AACA,OAAOC,SAAP,MAAsB,eAAtB;AAGA,OAAO,MAAMC,WAAW,GAAG,YAAY;EAAA;;EACnC,MAAMC,eAAe,GAAGC,MAAxB;EACA,MAAMC,YAAY,GAAG,MAAMC,YAAY,CAACC,OAAb,CAAqB,cAArB,CAA3B;EACA,MAAM;IAACH,MAAD;IAASI;EAAT,IAAsBP,SAAS,CAAC,EAAD,CAArC,CAHmC,CAKnC;;EACA,MAAMQ,mBAAmB,GAAG,MAAMC,KAAK,CAEpC,GAAEV,UAAW,qBAFuB,EAGrC;IACIW,MAAM,EAAE,MADZ;IAEIC,OAAO,EAAE;MACL,UAAU,kBADL;MAEL,gBAAgB;IAFX,CAFb;IAMIC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;MACnB,SAASZ;IADU,CAAf;EANV,CAHqC,CAAvC;;EAeA,IAAIM,mBAAmB,CAACO,MAApB,KAA+B,GAAnC,EAAwC;IACtC,MAAMC,gBAAgB,GAAG,MAAMP,KAAK,CACjC,GAAEV,UAAW,gBADoB,EAElC;MACIW,MAAM,EAAE,MADZ;MAEIC,OAAO,EAAE;QACL,UAAU,kBADL;QAEL,gBAAgB;MAFX,CAFb;MAMIC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;QACnB,WAAWV;MADQ,CAAf;IANV,CAFkC,CAApC;;IAcA,IAAIY,gBAAgB,CAACD,MAAjB,KAA4B,GAAhC,EAAqC;MACnC,MAAMV,YAAY,CAACY,OAAb,CAAqB,cAArB,EAAqCC,IAAI,CAACC,OAA1C,CAAN;MACAZ,SAAS,CACL;QACIJ,MAAM,EAACe,IAAI,CAACf;MADhB,CADK,CAAT;IAKD;EAEF;;EAAA,CA7CkC,CA+CnC;;EACA,MAAMiB,oBAAoB,GAAG,MAAMX,KAAK,CACrC,GAAEV,UAAW,sBADwB,EAEtC;IACIW,MAAM,EAAE,MADZ;IAEIC,OAAO,EAAE;MACL,UAAU,kBADL;MAEL,gBAAgB;IAFX,CAFb;IAMIC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;MACnB,SAASV;IADU,CAAf;EANV,CAFsC,CAAxC;;EAcA,IAAIgB,oBAAoB,CAACL,MAArB,KAAgC,GAApC,EAAyC;IACvCM,KAAK,CAAC,sCAAD,CAAL;IACAC,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuB,QAAvB;EACD,CAjEkC,CAoEnC;;;EACA,IAAIC,WAAW,KAAK,IAApB,EAA0B;IACxBC,OAAO,CAACC,GAAR,CAAY,sCAAZ;IACAL,MAAM,CAACC,QAAP,GAAkB,eAAlB;IACA,OAAO,EAAP;EACD;AACJ,CA1EM;;GAAMtB,W;UAGmBD,S"},"metadata":{},"sourceType":"module"}