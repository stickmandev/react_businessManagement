{"ast":null,"code":"import { backendURL } from \"../../backendURL\";\nexport const verifyTokens = async access => {\n  const refreshtoken = localStorage.getItem(\"refreshToken\");\n  console.log(\"verifying tokens......\");\n  console.log(access); // console.log(refreshtoken)\n  // Verifying access token___________________________________________________________________________________\n\n  await console.log(\"verifying access token......\");\n  const verify_access_token = await fetch(`${backendURL}/user/verifyAccess/`, {\n    method: 'POST',\n    headers: {\n      'Accept': 'Application/JSON',\n      'Content-Type': 'Application/json'\n    },\n    body: JSON.stringify({\n      access: `${access}`\n    })\n  });\n  console.log(verify_access_token.status + \": finished verifying access token\");\n\n  if (verify_access_token.status === 400) {\n    await console.log(\"access token expired......\"); // fetching new access and refresh token___________________________________________________________________________________\n\n    await console.log(\"fetching new access and refresh token......\");\n    const get_access_token = await fetch(`${backendURL}/user/refresh/`, {\n      method: 'POST',\n      headers: {\n        'Accept': 'Application/JSON',\n        'Content-Type': 'Application/json'\n      },\n      body: JSON.stringify({\n        \"refresh\": `${refreshtoken}`\n      })\n    });\n    await console.log('finished fetching access and refresh token');\n    awaitconsole.log(verify_access_token.refresh);\n    console.log(\"setting access and refresh token\");\n\n    if (get_access_token.status === 200) {\n      await localStorage.setItem(\"refreshToken\", verify_access_token.refresh);\n      const access = verify_access_token.access;\n      console.log('finished setting tokens');\n    }\n\n    if (get_access_token.status === (401 || 400)) {\n      // Verifying refresh token__________________________________________________________________________________\n      console.log('Verifying refresh token....');\n      const verify_refresh_token = await fetch(`${backendURL}/user/verifyRefresh/`, {\n        method: 'POST',\n        headers: {\n          'Accept': 'Application/JSON',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          \"token\": `${refreshtoken}`\n        })\n      });\n      console.log('finished verifying refresh token');\n\n      if (verify_refresh_token.status === (401 || 400)) {\n        alert(\"session expired, please log in again\");\n        console.log('redirecting to login');\n        window.location.assign(\"/login\");\n      }\n    }\n  }\n\n  ;\n};","map":{"version":3,"names":["backendURL","verifyTokens","access","refreshtoken","localStorage","getItem","console","log","verify_access_token","fetch","method","headers","body","JSON","stringify","status","get_access_token","awaitconsole","refresh","setItem","verify_refresh_token","alert","window","location","assign"],"sources":["/home/gcg/Desktop/Programing /python/Django main projects/projects/businessManagement/react_BusinessManagement/src/features/auths/verifyTokens.js"],"sourcesContent":["import {backendURL} from \"../../backendURL\"\n\nexport const verifyTokens = async (access) => {\n    \n    const refreshtoken =  localStorage.getItem(\"refreshToken\");\n    console.log(\"verifying tokens......\")\n    console.log(access)\n    // console.log(refreshtoken)\n    \n    // Verifying access token___________________________________________________________________________________\n    await console.log(\"verifying access token......\")\n    const verify_access_token = await fetch(\n      `${backendURL}/user/verifyAccess/`,\n      {\n          method: 'POST',\n          headers: {\n              'Accept': 'Application/JSON',\n              'Content-Type': 'Application/json',\n          },\n          body: JSON.stringify({\n            access: `${access}`,\n          })\n      }\n    );\n    console.log(verify_access_token.status+\": finished verifying access token\")\n  \n    if (verify_access_token.status === 400 ) {\n        await console.log(\"access token expired......\")\n\n        // fetching new access and refresh token___________________________________________________________________________________\n        await console.log(\"fetching new access and refresh token......\")\n        const get_access_token = await fetch(\n            `${backendURL}/user/refresh/`,\n            {\n                method: 'POST',\n                headers: {\n                    'Accept': 'Application/JSON',\n                    'Content-Type': 'Application/json',\n                },\n                body: JSON.stringify({\n                \"refresh\": `${refreshtoken}`,\n                })\n            }\n        );\n        await console.log('finished fetching access and refresh token')\n\n        awaitconsole.log(verify_access_token.refresh)\n        console.log(\"setting access and refresh token\")\n        if (get_access_token.status === 200) {\n            await localStorage.setItem(\"refreshToken\", verify_access_token.refresh);\n            const access = verify_access_token.access\n            console.log('finished setting tokens')\n        }\n\n        if (get_access_token.status === (401||400)) {\n            // Verifying refresh token__________________________________________________________________________________\n            console.log('Verifying refresh token....')\n            const verify_refresh_token = await fetch(\n            `${backendURL}/user/verifyRefresh/`,\n            {\n                method: 'POST',\n                headers: {\n                    'Accept': 'Application/JSON',\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({\n                \"token\": `${refreshtoken}`,\n                })\n            }\n            );\n            console.log('finished verifying refresh token')\n            \n        \n            if (verify_refresh_token.status === (401||400)) {\n                alert(\"session expired, please log in again\")\n                console.log('redirecting to login')\n                window.location.assign(\"/login\");\n            }\n\n      }\n  \n    };\n    \n    \n}\n"],"mappings":"AAAA,SAAQA,UAAR,QAAyB,kBAAzB;AAEA,OAAO,MAAMC,YAAY,GAAG,MAAOC,MAAP,IAAkB;EAE1C,MAAMC,YAAY,GAAIC,YAAY,CAACC,OAAb,CAAqB,cAArB,CAAtB;EACAC,OAAO,CAACC,GAAR,CAAY,wBAAZ;EACAD,OAAO,CAACC,GAAR,CAAYL,MAAZ,EAJ0C,CAK1C;EAEA;;EACA,MAAMI,OAAO,CAACC,GAAR,CAAY,8BAAZ,CAAN;EACA,MAAMC,mBAAmB,GAAG,MAAMC,KAAK,CACpC,GAAET,UAAW,qBADuB,EAErC;IACIU,MAAM,EAAE,MADZ;IAEIC,OAAO,EAAE;MACL,UAAU,kBADL;MAEL,gBAAgB;IAFX,CAFb;IAMIC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;MACnBZ,MAAM,EAAG,GAAEA,MAAO;IADC,CAAf;EANV,CAFqC,CAAvC;EAaAI,OAAO,CAACC,GAAR,CAAYC,mBAAmB,CAACO,MAApB,GAA2B,mCAAvC;;EAEA,IAAIP,mBAAmB,CAACO,MAApB,KAA+B,GAAnC,EAAyC;IACrC,MAAMT,OAAO,CAACC,GAAR,CAAY,4BAAZ,CAAN,CADqC,CAGrC;;IACA,MAAMD,OAAO,CAACC,GAAR,CAAY,6CAAZ,CAAN;IACA,MAAMS,gBAAgB,GAAG,MAAMP,KAAK,CAC/B,GAAET,UAAW,gBADkB,EAEhC;MACIU,MAAM,EAAE,MADZ;MAEIC,OAAO,EAAE;QACL,UAAU,kBADL;QAEL,gBAAgB;MAFX,CAFb;MAMIC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;QACrB,WAAY,GAAEX,YAAa;MADN,CAAf;IANV,CAFgC,CAApC;IAaA,MAAMG,OAAO,CAACC,GAAR,CAAY,4CAAZ,CAAN;IAEAU,YAAY,CAACV,GAAb,CAAiBC,mBAAmB,CAACU,OAArC;IACAZ,OAAO,CAACC,GAAR,CAAY,kCAAZ;;IACA,IAAIS,gBAAgB,CAACD,MAAjB,KAA4B,GAAhC,EAAqC;MACjC,MAAMX,YAAY,CAACe,OAAb,CAAqB,cAArB,EAAqCX,mBAAmB,CAACU,OAAzD,CAAN;MACA,MAAMhB,MAAM,GAAGM,mBAAmB,CAACN,MAAnC;MACAI,OAAO,CAACC,GAAR,CAAY,yBAAZ;IACH;;IAED,IAAIS,gBAAgB,CAACD,MAAjB,MAA6B,OAAK,GAAlC,CAAJ,EAA4C;MACxC;MACAT,OAAO,CAACC,GAAR,CAAY,6BAAZ;MACA,MAAMa,oBAAoB,GAAG,MAAMX,KAAK,CACvC,GAAET,UAAW,sBAD0B,EAExC;QACIU,MAAM,EAAE,MADZ;QAEIC,OAAO,EAAE;UACL,UAAU,kBADL;UAEL,gBAAgB;QAFX,CAFb;QAMIC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;UACrB,SAAU,GAAEX,YAAa;QADJ,CAAf;MANV,CAFwC,CAAxC;MAaAG,OAAO,CAACC,GAAR,CAAY,kCAAZ;;MAGA,IAAIa,oBAAoB,CAACL,MAArB,MAAiC,OAAK,GAAtC,CAAJ,EAAgD;QAC5CM,KAAK,CAAC,sCAAD,CAAL;QACAf,OAAO,CAACC,GAAR,CAAY,sBAAZ;QACAe,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuB,QAAvB;MACH;IAEN;EAEF;;EAAA;AAGJ,CAlFM"},"metadata":{},"sourceType":"module"}